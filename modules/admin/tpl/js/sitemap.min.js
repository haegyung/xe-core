jQuery(function(c){function o(a,c){for(var b=0,h=0;a&&a!=c;)b+=a.offsetTop,h+=a.offsetLeft,a=a.offsetParent;return{top:b,left:h}}var l=false,k=c('<li class="placeholder">');c("form.siteMap").delegate("li:not(.placeholder)",{"mousedown.st":function(a){var d,b,h,g,n,p,i,m,j;if(!(c(a.target).is("a,input,label,textarea")||a.which!=1)){l=true;b=c(this);p=b.height();n=b.width();h=b.parentsUntil(".siteMap").filter("ul");g=h.eq(-1);g.css("position","relative");d=a.pageY;i=o(this,g.get(0));$clone=b.clone(true).attr("target",
true);for(a=h.length-1;a;a--)$clone=$clone.wrap("<li><ul /></li>").parent().parent();m=[];g.find("li").each(function(){if(b[0]===this||b.has(this).length)return true;var a=o(this,g.get(0));m.push({top:a.top,bottom:a.top+32,item:this})});$clone.find(".side,input").remove().end().addClass("draggable").css({position:"absolute",opacity:0.6,width:n,height:p,left:i.left,top:i.top,zIndex:100}).appendTo(g.eq(0));k.css({position:"absolute",opacity:0.6,width:n,height:"5px",left:i.left,top:i.top,zIndex:99}).appendTo(g.eq(0));
b.css("opacity",0.6);c(document).unbind("mousemove.st mouseup.st").bind("mousemove.st",function(a){var b,c,e,f;j=null;a=i.top-(d-a.pageY);for(b=0,c=m.length;b<c;b++){f=a;e=m[b];if(b==0&&f<e.top)f=e.top;if(b==c-1&&f>e.bottom)f=e.bottom;if(e.top<=f&&e.bottom>=f){b=e.item;Math.abs(e.top-f)<=3?(k.css({top:e.top-3,height:"5px"}),f="before"):Math.abs(e.bottom-f)<=3?(k.css({top:e.bottom-3,height:"5px"}),f="after"):(k.css({top:e.top+3,height:"27px"}),f="prepend");j={element:b,state:f};break}}$clone.css({top:a})}).bind("mouseup.st",
function(){var a,d;l=false;c(document).unbind("mousemove.st mouseup.st");b.css("opacity","");$clone.remove();k.remove();d=c("<li />").height(b.height());if(j){a=c(j.element);b.before(d);if(j.state=="prepend")a.find(">ul").length||a.find(">.side").after("<ul>"),a.find(">ul").prepend(b.hide());else a[j.state](b.hide());b.slideDown(100,function(){b.removeClass("active")});d.slideUp(100,function(){var a=d.parent();d.remove();a.children("li").length||a.remove()});b.trigger("dropped.st")}});return false}},
"mouseover.st":function(){l||c(this).addClass("active");return false},"mouseout.st":function(){l||c(this).removeClass("active");return false}}).find("li").prepend('<button type="button" class="moveTo">Move to</button>').append('<span class="vr"></span><span class="hr"></span>').find("input:text").focus(function(){var a=c(this),d=a.prev("label"),b=a.parent();a.width(b.width()-(parseInt(b.css("text-indent"))||0)-a.next(".side").width()-60).css("opacity","");d.hide()}).blur(function(){var a=c(this),
d=a.prev("label"),b=a.val();a.width(0).css("opacity",0);d.removeClass("no-text").empty().text(b).show();b||d.addClass("no-text").text("---")}).each(function(a){var d=c(this),a="sitemap-id-"+a;d.attr("id",a).css({width:0,opacity:0,overflow:"hidden"}).before("<label />").prev("label").attr("for",a).text(d.val())}).end().end()});
